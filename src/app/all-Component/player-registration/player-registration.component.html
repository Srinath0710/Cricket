<div class="full-page-container">

  <div class="page-wrapper">
    <div class="content container-fluid">
      <main>
        <div class="card margin-card">
          <div class="card-body">
            <div class="page-header main-page-header d-flex align-items-center justify-content-between">
              <div class="main-page-title playerbackground ">
                <i class="fa-solid fa-person-running" aria-hidden="true"></i>
                All Players
                <div class="totalrecord">: {{ totalData }}</div>
              </div>

              <div class="col-md-2 d-flex align-items-center gap-3 dropdown-right me-2">
                <p-dropdown [options]="clientData" *ngIf="isClientShow" optionLabel="client_name"
                  optionValue="client_id" [(ngModel)]="client_id" (ngModelChange)="gridLoad()" placeholder="Client Id"
                  [filter]="true" appendTo="body" class=" w-100 
                 drop-error header-drop">
                  <ng-template let-Client pTemplate="item">
                    <div class="country-item">
                      <div>{{ Client.client_name }}</div>
                    </div>
                  </ng-template>
                </p-dropdown>
              </div>

              <div class="d-flex align-items-center">
                <!-- Search Form -->
                <form class="d-flex align-items-center  gap-2" (submit)="gridLoad()">
                  <div class="p-input-icon-right flex-grow-1">
                    <!-- <i class="pi pi-search" ></i> -->
                    <input pInputText type="text" [(ngModel)]="searchKeyword" name="searchKeyword" class="width-search"
                      placeholder="Search" (input)="filterGlobal()" (keypress)="blockQuotesOnly($event)"
                      (input)="sanitizeQuotesOnly('Search', $event)">
                  </div>
                  <button type="button" class="clear-button" (click)="clear()"> Clear </button>
                </form>

                <!-- Filter Button -->
                <div class="filter-icon-wrapper">
                  <button class="filter-icon-button" (click)="toggleFilters()">
                    <i class="fa fa-filter"></i>
                  </button>
                </div>

                <!-- Add Button -->
                <div class="card flex justify-center">
                  <button *ngIf="!ShowForm" class="new-button p-button-text" (click)="resetForm()"
                    (click)="showAddForm();editLabel()"> <i class="fas fa-plus"></i> Create</button>
                </div>
              </div>
            </div>
            <!-- STATUS Confirmation POPUP -->
            <p-confirmDialog [style]="{width: '300px', height: '200px'}" [baseZIndex]="10000" [draggable]="false"
              [closable]="false" [styleClass]="'p-confirm-dialog-custom'">
            </p-confirmDialog>

            <p-table #dt [value]="PlayerData" [styleClass]="'custom-table'"
              [globalFilterFields]="['display_name','player_dob','mobile_no','email','record_status']">
              <ng-template pTemplate="header">

                <tr>
                  <th>
                    <div class="d-flex justify-content-between align-items-center w-100">
                      Player Name
                      <p-sortIcon field="display_name" pSortableColumn="display_name"></p-sortIcon>
                    </div>
                  </th>
                  <th>
                    <div class="d-flex justify-content-between align-items-center w-100">
                      DOB
                      <p-sortIcon field="player_dob" pSortableColumn="player_dob"></p-sortIcon>
                    </div>
                  </th>
                  <th>
                    <div class="d-flex justify-content-between align-items-center w-100">
                      Mobile Number
                      <p-sortIcon field="mobile_no" pSortableColumn="mobile_no"></p-sortIcon>
                    </div>
                  </th>
                  <th>
                    <div class="d-flex justify-content-between align-items-center w-100">
                      Email
                      <p-sortIcon field="email" pSortableColumn="email"></p-sortIcon>
                    </div>
                  </th>
                  <th>
                    <div class="d-flex justify-content-between align-items-center w-100">
                      Status
                      <p-sortIcon field="record_status" pSortableColumn="record_status"></p-sortIcon>
                    </div>
                  </th>
                  <th class="custom-header action-column-header">Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-player let-even="even">
                <tr [ngClass]="{'even-row': even}">
                  <td>
                    <div class="player-name-cell">
                      <span class="person-image-team-player">
                        <img class="player-img" *ngIf="player.profile_image==null || player.profile_image==''"
                          [src]="default_img">

                        <img class="player-img" *ngIf="player.profile_image!=null  && player.profile_image!=''"
                          [src]="player.profile_image" (error)="handleImageError($event, default_img)">
                      </span>
                      <span class="name-space">{{ player.display_name }}</span>

                    </div>
                  </td>
                  <td>{{ player.player_dob }}</td>
                  <td>{{ player.mobile_no }}</td>
                  <td>{{ player.email }}</td>
                  <td>
                    <span [ngClass]="{
                        ' bg-success': player.record_status === 'Active',
                        ' bg-danger': player.record_status === 'InActive'
                      }">
                      {{ player.record_status }}
                    </span>
                  </td>

                  <td>
                    <div class="action-icons">
                      <span class="icon-blue" (click)="Editplayer(player)" pTooltip="Edit" tooltipPosition="top">
                        <i class="fa-solid fa-user-pen"></i>
                      </span>

                      <span class="icon-green"
                        (click)="StatusConfirm(player.player_id, conditionConstants.active_status, player.record_status)"
                        pTooltip="Activate" tooltipPosition="top">
                        <i class="fa-solid fa-circle-check"></i>
                      </span>

                      <span class="icon-red"
                        (click)="StatusConfirm(player.player_id, conditionConstants.deactive_status, player.record_status)"
                        pTooltip="Deactivate" tooltipPosition="top">
                        <i class="fa-solid fa-trash-can-arrow-up"></i>
                      </span>

                      <span class="icon-rose" pTooltip="Personal Info" tooltipPosition="top"
                        (click)="EditpersonalPlayers(player)">
                        <i class="fa-solid fa-building-columns"></i>
                      </span>
                    </div>
                  </td>

                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="6" class="text-center">No Records Found</td>
                </tr>
              </ng-template>
            </p-table>

            <p-paginator [rows]="rows" [totalRecords]="totalData" [first]="(first - 1) * rows"
              [rowsPerPageOptions]="[10, 25,50,100]" (onPageChange)="onPageChange($event)">
            </p-paginator>

            <p-drawer [(visible)]="ShowForm" [baseZIndex]="10000" position="right" [showCloseIcon]="false">
              <div class="d-flex justify-content-between align-items-center mb-4 form-drawer-header">
                <div class="small-heading">
                  <div
                    *ngIf="playerRegistrationform.get('player_id')?.value == '' || playerRegistrationform.get('player_id')?.value == null">
                    Add Player </div>
                  <div
                    *ngIf="playerRegistrationform.get('player_id')?.value != null && playerRegistrationform.get('player_id')?.value != ''">
                    Edit Player</div>
                </div>
              </div>

              <form [formGroup]="playerRegistrationform">
                <div class="row">
                  <!-- Left Column - Input Fields -->
                  <div class="col-md-6">
                    <div class="p-3 border rounded shadow-sm h-100 bg-white">
                      <h5 class="mb-3">Player Information</h5>
                      <div class="row gy-3">
                        <div class="col-md-6">
                          <label>First Name </label>
                          <span class="text-danger">*</span>
                          <input class="form-control" type="text" maxlength="50" formControlName="first_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('first_name', $event)">
                          <small
                            *ngIf="playerRegistrationform.get('first_name')?.invalid && (playerRegistrationform.get('first_name')?.touched || submitted)"
                            class="required-msg">First name is Required</small>
                        </div>

                        <div class="col-md-6">
                          <label>Middle Name</label>
                          <input class="form-control" type="text" maxlength="50" formControlName="middle_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('middle_name', $event)">
                        </div>

                        <div class="col-md-6">
                          <label>Sure Name</label>
                          <span class="text-danger">*</span>
                          <input class="form-control" type="text" maxlength="50" formControlName="sur_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('sur_name', $event)">
                          <small
                            *ngIf="playerRegistrationform.get('sur_name')?.invalid && (playerRegistrationform.get('sur_name')?.touched || submitted)"
                            class="required-msg">Sur name is Required</small>
                        </div>

                        <div class="col-md-6">
                          <label>Display Name <span class="text-danger">*</span></label>
                          <input class="form-control" type="text" maxlength="50" formControlName="display_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('display_name', $event)">
                          <small
                            *ngIf="playerRegistrationform.get('display_name')?.invalid && (playerRegistrationform.get('display_name')?.touched || submitted)"
                            class="required-msg">Display name is Required</small>
                        </div>

                        <div class="col-md-6">
                          <label>Gender</label>
                          <span class="text-danger">*</span>
                          <p-dropdown [options]="genderSelect" class="drop-error " formControlName="gender_id"
                            optionValue="config_id" optionLabel="config_name" placeholder="Select Gender"
                            [panelStyleClass]="'custom-dropdown-panel'">
                            <ng-template let-gender pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ gender.config_name }}
                                </div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small
                            *ngIf="playerRegistrationform.get('gender_id')?.invalid &&(playerRegistrationform.get('gender_id')?.touched) || (playerRegistrationform.get('gender_id')?.invalid && submitted)"
                            class="required-msg"> Gender is Required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>Player DOB</label>
                          <input class="form-control" type="date" placeholder="Enter DOB" formControlName="player_dob">
                        </div>

                        <div class="col-md-6">
                          <label>Phone No</label>
                          <input class="form-control" type="text" maxlength="10" formControlName="mobile_no"
                            (input)="onPhoneNumberInput($event,'mobile_no')">
                          <div
                            *ngIf="playerRegistrationform.get('mobile_no')?.touched && playerRegistrationform.get('mobile_no')?.invalid">
                            <small *ngIf="playerRegistrationform.get('mobile_no')?.errors?.['pattern']"
                              class="required-msg">
                              * Invalid mobile number
                            </small>
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label>Email Id
                            <span class="text-danger">*</span>
                          </label>
                          <input type="email" formControlName="email" class="form-control" placeholder="Enter Email">

                          <div
                            *ngIf="playerRegistrationform.get('email')?.touched && playerRegistrationform.get('email')?.invalid">
                            <small *ngIf="playerRegistrationform.get('email')?.errors?.['required']"
                              class="required-msg">
                              Email ID is Required
                            </small>
                            <small *ngIf="playerRegistrationform.get('email')?.errors?.['pattern']"
                              class="required-msg">
                              Invalid email: abcd&#64;example.com
                            </small>
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label>Club ID</label>
                          <p-dropdown [options]="clublist" class="drop-error " formControlName="club_id"
                            optionValue="club_id" optionLabel="club_name" placeholder="Select Club Id">
                            <ng-template let-club pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ club.club_name }}
                                </div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                        </div>

                        <div class="col-md-6">
                          <label>Nationality</label>
                          <span class="text-danger">*</span>
                          <p-dropdown [options]="NationalitydropdownData" formControlName="nationality_id"
                            optionValue="region_id" optionLabel="region_name" placeholder="Select Nationality Country"
                            class="drop-error" [panelStyleClass]="'custom-dropdown-panel'">
                            <ng-template let-nationality pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ nationality.region_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small *ngIf="playerRegistrationform.get('nationality_id')?.invalid && 
                              (playerRegistrationform.get('nationality_id')?.touched || submitted)"
                            class="required-msg">
                            Nationality is Required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>Reference Sourece ID </label>
                          <input class="form-control" type="text" maxlength="20" formControlName="reference_id"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('reference_id', $event)">
                        </div>

                        <div class="col-md-6">
                          <label>Scorecard Name</label>
                          <input class="form-control" type="text" maxlength="50" formControlName="scorecard_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('scorecard_name', $event)">
                        </div>

                        <div class="col-md-6">
                          <label>Jersey No</label>
                          <input class="form-control" type="number" formControlName="jersey_no">
                        </div>

                        <div class="col-md-6">
                          <label>Remarks</label>
                          <textarea class="form-control" formControlName="remarks" rows="4" maxlength="500"
                            (keypress)="blockQuotesOnly($event)"
                            (input)="sanitizeQuotesOnly('remarks', $event)"></textarea>

                          <small
                            *ngIf="playerRegistrationform.get('remarks')?.errors?.['maxlength'] && (playerRegistrationform.get('remarks')?.touched || submitted)"
                            class="required-msg">
                            Remarks cannot exceed 500 characters.
                          </small>
                        </div>
                        <div class="col-md-6">
                          <label>Profile Image</label>
                          <div class="image-upload-container text-center">

                            <div class="image-preview-wrapper">
                              <button type="button" class="cancel-btn" (click)="cancel()">âœ•</button>
                              <img
                                *ngIf="(filedata == null || filedata == '') && (profileImages == null || profileImages == '')"
                                [src]="default_img" alt="Profile Image" class="profile-img">
                              <img *ngIf="filedata != null && filedata != ''" [src]="url" alt="Profile Image"
                                class="profile-img">
                              <img *ngIf="profileImages != null && profileImages != ''" [src]="profileImages"
                                (error)="handleImageError($event, default_img)" alt="Profile Image" class="profile-img">
                            </div>


                            <div class="split-button-wrapper">
                              <label for="profileImageInput" class="split-button upload-half">
                                <input type="file" id="profileImageInput" accept="image/*" (change)="fileEvent($event)"
                                  hidden hidden formControlName="profile_image" />
                                Upload
                              </label>
                              <button type="button" class="split-button crop-half" (click)="cropPopOpen()">
                                Crop
                              </button>
                            </div>

                          </div>
                          <small class="text-danger" *ngIf="playerRegistrationform.get('profile_image')?.errors">
                            * Only PNG,JPEG, or JPG files are allowed
                          </small>

                          <!-- Cropper Model -->
                          <div *ngIf="showCropperModal" class="modal img-croper-popup">
                            <div class="modal-content crop-image">
                              <div class="modal-header modal-header-img">
                                <h2 style="font-size: 20px; margin-left: 38%;">Crop Image</h2>
                              </div>
                              <div class="modal-body img-fix">
                                <image-cropper [imageBase64]="imageBase64" [maintainAspectRatio]="true"
                                  [aspectRatio]="4 / 3" (imageCropped)="imageCropped($event)"
                                  (imageLoaded)="imageLoaded()" (cropperReady)="cropperReady()"
                                  (loadImageFailed)="loadImageFailed()">
                                </image-cropper>
                              </div>
                              <div class="modal-footer crop-footer">
                                <button class="submit-btn margin-right save-button"
                                  (click)="saveCroppedImage()">Save</button>
                                <button class=" custom-cancel-btn submit-btn margin-right"
                                  (click)="cancelImg()">Cancel</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Column - Radio Buttons -->

                  <div class="col-md-6">
                    <div class="box-card">
                      <div class="p-3 border rounded shadow-sm h-100 bg-white">
                        <h5 class="mb-3">Player Style & Role</h5>
                        <div class="row gy-3">
                          <!-- Player Role -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label class="">Player Role <span class="text-danger">*</span></label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let role of playerrole; let i = index" class="d-flex align-items-center">
                                  <p-radiobutton name="player_role_id" [inputId]="'player_role' + i"
                                    [value]="role.config_id" formControlName="player_role_id"></p-radiobutton>
                                  <label class="ms-3" [for]="'player_role' + i">{{ role.config_name }}</label>
                                </div>
                              </div>
                            </div>

                            <small *ngIf="playerRegistrationform.get('player_role_id')?.invalid &&
                                           (playerRegistrationform.get('player_role_id')?.touched || submitted)"
                              class="playersrequired-msg">
                              Player Role is Required
                            </small>
                          </div>

                          <!-- Bowling Style -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label>Bowling Style</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let style of bowlingstyle; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="bowling_style_id" [inputId]="'bowling_style' + i"
                                    [value]="style.config_id" formControlName="bowling_style_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'bowling_style' + i">{{ style.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Batting Style -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label>Batting Style <span class="text-danger">*</span></label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let style of battingstyle; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="batting_style_id" [inputId]="'batting_style' + i"
                                    [value]="style.config_id" formControlName="batting_style_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'batting_style' + i">{{ style.config_name }}</label>
                                </div>
                              </div>
                            </div>

                            <small *ngIf="playerRegistrationform.get('batting_style_id')?.invalid &&
               (playerRegistrationform.get('batting_style_id')?.touched || submitted)" class="playersrequired-msg">
                              Batting Style is Required
                            </small>
                          </div>

                          <!-- Bowling Type -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label>Bowling Type</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let type of bowlingtype; let i = index" class="d-flex align-items-center">
                                  <p-radiobutton name="bowling_type_id" [inputId]="'bowling_type' + i"
                                    [value]="type.config_id" formControlName="bowling_type_id"
                                    (onClick)="onBowlingTypeChange(type.config_id)"></p-radiobutton>
                                  <label class="ms-2" [for]="'bowling_type' + i">{{ type.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Batting Order -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label>Batting Order</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let order of battingorder; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="batting_order_id" [inputId]="'batting_order' + i"
                                    [value]="order.config_id" formControlName="batting_order_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'batting_order' + i">{{ order.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Bowling Spec -->
                          <div class="col-md-6" *ngIf="filteredSpecs.length > 0">
                            <div class="border rounded p-3">
                              <label>Bowling Spec</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let spec of filteredSpecs; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="bowling_spec_id" [inputId]="'bowling_spec' + i"
                                    [value]="spec.config_id" formControlName="bowling_spec_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'bowling_spec' + i">{{ spec.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div> <!-- end row -->
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-wrapper pb-5">
                  <div class="row mt-4 sticky-footer-buttons">
                    <div class="col-12 text-end">
                      <button pButton type="button" label="Cancel" class="p-button-secondary me-3 custom-cancel-btn"
                        (click)="cancelForm()"></button>

                      <button pButton type="button" label="Clear" class="p-button-secondary me-3 custom-cancel-btn"
                        *ngIf="playerRegistrationform.get('player_id')?.value == '' || playerRegistrationform.get('player_id')?.value == null"
                        (click)="resetForm()"></button>

                      <button pButton label="Save" class="save-button"
                        (click)="duplicateChange(playerRegistrationform.get('player_id')?.value != '' && playerRegistrationform.get('player_id')?.value != null)">
                      </button>
                    </div>
                  </div>
                </div>

              </form>

              <p-dialog header="Duplicate Player Found" [modal]="true" [(visible)]="visible"
                [style]="{ width: '60rem', 'border-radius': '10px' }" [contentStyle]="{ 'padding': '1.5rem' }"
                styleClass="custom-duplicate-dialog">

                <div style="font-weight: bold; font-size: 1.5rem; margin-bottom: 1rem; text-align: center;">
                  Similar Player(s) Already Exist!
                </div>
                <p-table [value]="duplicatePlayers" [globalFilterFields]="['display_name']" [paginator]="true"
                  [rows]="5" styleClass="p-datatable-gridlines">
                  <ng-template pTemplate="header">
                    <tr>
                      <th pSortableColumn="display_name">Player Name <p-sortIcon field="display_name"></p-sortIcon></th>
                      <th pSortableColumn="gender">Gender <p-sortIcon field="gender"></p-sortIcon></th>
                      <th pSortableColumn="player_role">Role <p-sortIcon field="player_role"></p-sortIcon></th>
                      <th pSortableColumn="batting_style">Batting Style <p-sortIcon field="batting_style"></p-sortIcon>
                      </th>
                      <th pSortableColumn="bowling_style">Bowling Style <p-sortIcon field="bowling_style"></p-sortIcon>
                      </th>
                      <th pSortableColumn="bowling_type">Bowling Type <p-sortIcon field="bowling_type"></p-sortIcon>
                      </th>
                      <th pSortableColumn="bowling_specialization">Specialization <p-sortIcon
                          field="bowling_specialization"></p-sortIcon></th>
                      <th pSortableColumn="batting_order">Order <p-sortIcon field="batting_order"></p-sortIcon></th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-player let-even="even">
                    <tr [ngClass]="{ 'p-highlight': even }">
                      <td>{{ player.display_name }}</td>
                      <td>{{ player.gender }}</td>
                      <td>{{ player.player_role }}</td>
                      <td>{{ player.batting_style }}</td>
                      <td>{{ player.bowling_style }}</td>
                      <td>{{ player.bowling_type }}</td>
                      <td>{{ player.bowling_specialization }}</td>
                      <td>{{ player.batting_order }}</td>
                    </tr>
                  </ng-template>
                </p-table>
                <!-- Footer -->
                <ng-template pTemplate="footer">
                  <div class="row mt-4 sticky-footer-buttons">
                    <div class="col-12 text-end">
                      <button pButton type="button" label="Cancel" class="p-button-secondary me-3 custom-cancel-btn"
                        (click)="hideDialog()"></button>

                      <button pButton label="Update" class="save-button" (click)="addplayerdata()"></button>
                    </div>
                  </div>
                </ng-template>
              </p-dialog>
            </p-drawer>
            <!-- Personal Update Form Page -->
            <p-drawer [(visible)]="personalShowForm" [baseZIndex]="10000" position="right" [showCloseIcon]="false"
              styleClass="drawer-personal">
              <div class="d-flex justify-content-between align-items-center mb-4 form-drawer-header">
                <button *ngIf="isPersonalDataIntialized" pButton type="button" (click)="enableEditMode()"
                  [ngClass]="disableReadonly ? 'readonly-true' : 'readonly-false'">
                  {{ disableReadonly ? 'Enable Edit' : 'Disable Edit' }}
                </button>
                <h3 class="small-heading">
                  {{ isEditPersonal ? 'Edit Personal Information' : 'Update Personal Information' }}
                </h3>
              </div>
              <form [formGroup]="addplayerpersonalform">
                <div class="row gy-3">
                  <!-- Left Column - Input Fields -->
                  <div class="col-md-6">
                    <div class="p-3 border rounded shadow-sm h-100 bg-white">
                      <h5 class="mb-3">Players Details</h5>
                      <div class="row gy-3">

                        <div class="col-md-6">
                          <label class="">Father Name</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="father_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('father_name', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Mother Name</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="mother_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('first_name', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Guardian</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="guardian_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('first_name', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label>Country Of Birth <span class="text-danger">*</span></label>
                          <p-dropdown [options]="countriesList" formControlName="country_of_birth"
                            optionValue="country_id" optionLabel="country_name" placeholder="Select Country"
                            class="drop-error" [panelStyleClass]="'custom-dropdown-panel'"
                            [readonly]="disableReadonly && isPersonalDataIntialized"
                            (ngModelChange)="getStates(addplayerpersonalform.get('country_id')?.value)">
                            <ng-template let-country pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ country.country_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small *ngIf="addplayerpersonalform.get('country_of_birth')?.invalid && 
                (addplayerpersonalform.get('country_of_birth')?.touched || submitted)" class="required-msg">
                            Country Of Birth is Required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>Primary Phone No</label>
                          <span class="text-danger">*</span>
                          <input class="form-control" type="text" maxlength="10" formControlName="primary_phone"
                            (input)="onPhoneNumberInput($event, 'primary_phone')"
                            [readonly]="disableReadonly&&isPersonalDataIntialized" />
                          <div
                            *ngIf="addplayerpersonalform.get('primary_phone')?.touched && addplayerpersonalform.get('primary_phone')?.invalid || (submitted && addplayerpersonalform.get('primary_phone')?.invalid)">
                            <small *ngIf="addplayerpersonalform.get('primary_phone')?.errors?.['required']"
                              class="required-msg">
                              * Mobile number is required
                            </small>
                            <small *ngIf="addplayerpersonalform.get('primary_phone')?.errors?.['pattern']"
                              class="required-msg">
                              * Invalid mobile number
                            </small>
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label>Secondary Phone NO</label>
                          <input class="form-control" type="text" maxlength="10" formControlName="secondary_phone"
                            (input)="onPhoneNumberInput($event, 'secondary_phone')"
                            [readonly]="disableReadonly&&isPersonalDataIntialized" />
                          <div
                            *ngIf="addplayerpersonalform.get('secondary_phone')?.touched && addplayerpersonalform.get('secondary_phone')?.invalid">
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label>Primary Email Id</label>
                          <span class="text-danger">*</span>
                          <input class="form-control" type="email" maxlength="100" formControlName="primary_email_id"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                          <div
                            *ngIf="addplayerpersonalform.get('primary_email_id')?.touched && addplayerpersonalform.get('primary_email_id')?.invalid">
                            <small *ngIf="addplayerpersonalform.get('primary_email_id')?.errors?.['required']"
                              class="required-msg">
                              * Email is required
                            </small>
                            <small *ngIf="addplayerpersonalform.get('primary_email_id')?.errors?.['pattern']"
                              class="required-msg">
                              * Invalid email: abcd&#64;example.com
                            </small>
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label>Secondary Email Id</label>
                          <input class="form-control" type="email" maxlength="100" formControlName="secondary_email_id"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                          <div
                            *ngIf="addplayerpersonalform.get('secondary_email_id')?.touched && addplayerpersonalform.get('secondary_email_id')?.invalid">
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label>Nationality <span class="text-danger">*</span></label>
                          <p-dropdown [options]="NationalitydropdownData" formControlName="nationality_id"
                            optionValue="region_id" optionLabel="region_name" placeholder="Select Nationality"
                            class="drop-error" [filter]="true" [panelStyleClass]="'custom-dropdown-panel'"
                            [readonly]="disableReadonly && isPersonalDataIntialized">

                            <ng-template let-gender pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ gender.region_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small *ngIf="addplayerpersonalform.get('nationality_id')?.invalid &&
                (addplayerpersonalform.get('nationality_id')?.touched || submitted)" class="required-msg">
                            Nationality is Required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>Residence Country <span class="text-danger">*</span></label>
                          <p-dropdown [options]="countriesList" formControlName="residence_country_id"
                            optionValue="country_id" optionLabel="country_name" placeholder="Select Residence Country"
                            class="drop-error" [panelStyleClass]="'custom-dropdown-panel'" appendTo="self"
                            [filter]="true" [readonly]="disableReadonly && isPersonalDataIntialized"
                            (ngModelChange)="getStates(addplayerpersonalform.get('country_id')?.value)">
                            <ng-template let-country pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ country.country_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small *ngIf="addplayerpersonalform.get('residence_country_id')?.invalid &&
                (addplayerpersonalform.get('residence_country_id')?.touched || submitted)" class="required-msg">
                            Residence Country is Required
                          </small>
                        </div>

                        <!-- Country Dropdown -->
                        <div class="col-md-6">
                          <label>Country <span class="text-danger">*</span></label>
                          <p-dropdown [options]="countriesList" formControlName="country_id" optionValue="country_id"
                            optionLabel="country_name" placeholder="Select Country" class="drop-error" appendTo="self"
                            [panelStyleClass]="'custom-dropdown-panel'" [filter]="true"
                            [readonly]="disableReadonly && isPersonalDataIntialized"
                            (ngModelChange)="getStates(addplayerpersonalform.get('country_id')?.value)">
                            <ng-template let-country pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ country.country_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small *ngIf="addplayerpersonalform.get('country_id')?.invalid &&
                (addplayerpersonalform.get('country_id')?.touched || submitted)" class="required-msg">
                            Country is required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>State <span class="text-danger">*</span></label>
                          <p-dropdown [options]="statesList" formControlName="state_id" optionValue="state_id"
                            optionLabel="state_name" placeholder="Select State" class="drop-error"
                            [panelStyleClass]="'custom-dropdown-panel'" [filter]="true"
                            [readonly]="disableReadonly && isPersonalDataIntialized"
                            (ngModelChange)="getCities(addplayerpersonalform.get('state_id')?.value)">
                            <ng-template let-state pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ state.state_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small *ngIf="addplayerpersonalform.get('state_id')?.invalid &&
                (addplayerpersonalform.get('state_id')?.touched || submitted)" class="required-msg">
                            State is required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>City
                          </label>
                          <p-dropdown [options]="citiesList" class="drop-error " formControlName="city_id"
                            placeholder="Select City" optionValue="city_id" optionLabel="city_name"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                            <ng-template let-city pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ city.city_name }}
                                </div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                        </div>

                        <div class="col-md-6">
                          <label class="">Post Code
                          </label>
                          <input class="form-control" maxlength="10" type="text" formControlName="post_code"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('post_code', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Address 1</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="address_1"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('first_name', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Address 2</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="address_2"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('first_name', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label>Emergency Phone NO</label>
                          <input class="form-control" type="text" maxlength="10" formControlName="emergency_number"
                            (input)="onPhoneNumberInput($event, 'emergency_number')"
                            [readonly]="disableReadonly&&isPersonalDataIntialized" />
                          <div
                            *ngIf="addplayerpersonalform.get('emergency_number')?.touched && addplayerpersonalform.get('emergency_number')?.invalid">
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label>Emergency Email Id</label>
                          <input class="form-control" type="email" maxlength="100" formControlName="emergency_email"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                          <div
                            *ngIf="addplayerpersonalform.get('emergency_email')?.touched && addplayerpersonalform.get('emergency_email')?.invalid">
                          </div>
                        </div>

                        <div class="col-md-6">
                          <label class="">Emergency Contact</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="emergency_contact"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('first_name', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label>Emergency Type </label>
                          <p-dropdown [options]="emergencyTypeList" class="drop-error" formControlName="emergency_type"
                            placeholder="Select Emergency Type" optionValue="config_id" optionLabel="config_name"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                            <ng-template let-item pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ item.config_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Column - Input Fields -->
                  <div class="col-md-6">
                    <div class="p-3 border rounded shadow-sm h-100 bg-white">
                      <h5 class="mb-3">Players Details</h5>
                      <div class="row gy-3">

                        <div class="col-md-6">
                          <label>Blood Group </label>
                          <p-dropdown [options]="bloodgroup" class="drop-error" formControlName="blood_group_id"
                            placeholder="Select Blood Group" optionValue="config_id" optionLabel="config_name"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                            <ng-template let-item pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ item.config_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                        </div>

                        <div class="col-md-6">

                          <label class="">Player Height</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="player_height"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('player_height', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Player Weight</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="player_weight"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('player_weight', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Medical Conditions</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="medical_conditions"
                            (keypress)="blockQuotesOnly($event)"
                            (input)="sanitizeQuotesOnly('medical_conditions', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Doctor Name</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="doctor_name"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('doctor_name', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label>Doctor Phone</label>
                          <input class="form-control" type="text" maxlength="10" formControlName="doctor_phone"
                            (input)="onPhoneNumberInput($event, 'doctor_phone')"
                            [readonly]="disableReadonly&&isPersonalDataIntialized" />
                          <div
                            *ngIf="addplayerpersonalform.get('doctor_phone')?.touched && addplayerpersonalform.get('doctor_phone')?.invalid">
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="">Allergies
                          </label>
                          <input class="form-control" maxlength="50" type="text" formControlName="allergies"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('allergies', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>
                        <div class="col-md-6">
                          <label class="">Medications</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="medications"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('medications', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Insurance Provider</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="insurance_provider"
                            (keypress)="blockQuotesOnly($event)"
                            (input)="sanitizeQuotesOnly('insurance_provider', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Policy Number</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="policy_number"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('policy_number', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label>Policy Expiry Date</label>
                          <input class="form-control" type="date" formControlName="policy_expiry_date"
                            [readonly]="disableReadonly && isPersonalDataIntialized" />
                        </div>

                        <div class="col-md-6">
                          <label class="">Twitter Handle</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="twitter_handle"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('twitter_handle', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Instagram Handle</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="instagram_handle"
                            (keypress)="blockQuotesOnly($event)"
                            (input)="sanitizeQuotesOnly('instagram_handle', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Facebook Url</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="facebook_url"
                            (keypress)="blockQuotesOnly($event)" (input)="sanitizeQuotesOnly('facebook_url', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                        <div class="col-md-6">
                          <label class="">Additional Notes</label>
                          <input class="form-control" maxlength="50" type="text" formControlName="additional_notes"
                            (keypress)="blockQuotesOnly($event)"
                            (input)="sanitizeQuotesOnly('additional_notes', $event)"
                            [readonly]="disableReadonly&&isPersonalDataIntialized">
                        </div>

                      </div>
                    </div>
                  </div>

                  <div class="form-wrapper pb-5">

                    <div class="row mt-4 sticky-footer-buttons">
                      <div class="col-12 text-end">

                        <button pButton type="button" label="Cancel" class="p-button-secondary me-3 custom-cancel-btn"
                          (click)="cancelForm()"></button>

                        <button *ngIf="!isEditPersonal" pButton type="button" label="Clear"
                          class="p-button-secondary me-3 custom-cancel-btn" (click)="resetForm()">
                        </button>

                        <button pButton type="button" label="Save" class="save-button"
                          (click)="Personalupdate()"></button>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
              <!-- </div
      </p-sidebar> -->
            </p-drawer>
          </div>
        </div>
      </main>
    </div>
  </div>

</div>

<p-toast position="center" [baseZIndex]="11000">
  <ng-template let-message pTemplate="message">
    <div class="custom-toast-message">
      <img *ngIf="message?.data?.image" [src]="message.data.image" style="width: 40px; height: 40px" />
      <div>
        <div class="font-bold">{{ message.summary }}</div>
        <div>{{ message.detail }}</div>
      </div>
    </div>
  </ng-template>
</p-toast>