<div class="full-page-container">

  <div class="page-wrapper">
    <div class="content container-fluid">
      <main>
        <div class="card margin-card">
          <div class="card-body">
            <div class="page-header main-page-header">
              <div class="main-page-title playerbackground">
                <i class="fa fa-user-circle" aria-hidden="true"></i>
                All Players
              </div>


              <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-center gap-2 mb-2">
                <p-dropdown [options]="clientData" optionLabel="client_name" optionValue="client_id"
                  [(ngModel)]="client_id" (ngModelChange)="gridLoad()" placeholder="Client Id" [filter]="true"
                  appendTo="body" class=" w-100 
                 drop-error header-drop">
                  <ng-template let-Client pTemplate="item">
                    <div class="country-item">
                      <div>{{ Client.client_name }}</div>
                    </div>
                  </ng-template>
                </p-dropdown>
              </div>


              <div class="d-flex align-items-center">
                <!-- Search Form -->
                <form class="d-flex align-items-center  gap-2" (submit)="gridLoad()">
                  <div class="p-input-icon-right flex-grow-1">
                    <!-- <i class="pi pi-search" ></i> -->
                    <input pInputText type="text" [(ngModel)]="searchKeyword" name="searchKeyword" class="width-search"
                      placeholder="Search" (input)="filterGlobal()" (keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('Search', $event)">
                  </div>

                  <button type="button" class="clear-button" (click)="clear()"> Clear </button>
                </form>


                <!-- Filter Button -->
                <div class="filter-icon-wrapper">
                  <button class="filter-icon-button" (click)="toggleFilters()">
                    <i class="fa fa-filter"></i>
                  </button>
                </div>

                <!-- Add Button -->
                <div class="card flex justify-center">
                  <button *ngIf="!ShowForm" class="new-button p-button-text" (click)="resetForm()"
                    (click)="showAddForm();editLabel()"> <i class="fas fa-plus"></i> Create</button>
                </div>





              </div>
            </div>
            <!-- STATUS Confirmation POPUP -->

            <p-confirmDialog [style]="{width: '300px', height: '200px'}" [baseZIndex]="10000" [draggable]="false"
              [closable]="false" [styleClass]="'p-confirm-dialog-custom'">
            </p-confirmDialog>




            <p-table #dt [value]="PlayerData" [styleClass]="'custom-table'"
              [globalFilterFields]="['display_name','player_dob','mobile_no','email','record_status']">
              <ng-template pTemplate="header">


                <tr>
                  <th pSortableColumn="display_name">Player Name
                    <p-sortIcon field="display_name"></p-sortIcon>
                  </th>
                  <th pSortableColumn="player_dob">DOB
                    <p-sortIcon field="player_dob"></p-sortIcon>
                  </th>
                  <th pSortableColumn="mobile_no">Mobile Number
                    <p-sortIcon field="mobile_no"></p-sortIcon>
                  </th>
                  <th pSortableColumn="email">Email
                    <p-sortIcon field="email"></p-sortIcon>
                  </th>
                  <th pSortableColumn="record_status">Status
                    <p-sortIcon field="record_status"></p-sortIcon>
                  </th>
                  <th class="custom-header action-column-header">Actions</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-player let-even="even">
                <tr [ngClass]="{'even-row': even}">
                  <td>
                    <div class="player-name-cell">
                      <span class="person-image-team-player">
                        <img class="player-img" *ngIf="!player.profile_img || !player.player_profile"
                          [src]="'assets/images/avatar.png'">

                        <img class="player-img" *ngIf="player.profile_img && player.player_profile"
                          [src]="player.profile_img">
                      </span>
                      <!-- <img src="assets/images/avatar.png" alt="Player" class="player-avatar"> -->
                      {{ player.display_name }}
                    </div>
                  </td>
                  <td>{{ player.player_dob }}</td>
                  <td>{{ player.mobile_no }}</td>
                  <td>{{ player.email }}</td>
                  <td>
                    <span [ngClass]="{
                        ' bg-success': player.record_status === 'Active',
                        ' bg-danger': player.record_status === 'InActive'
                      }">
                      {{ player.record_status }}
                    </span>
                  </td>


                  <td>

                    <span class="icon-blue" (click)="Editplayer(player)" pTooltip="Edit" tooltipPosition="top">
                      <i class="fa-solid fa-user-pen"></i>
                    </span>


                    <span class="icon-green"
                      (click)="StatusConfirm(player.player_id,conditionConstants.active_status)"
                      pTooltip="Activate" tooltipPosition="top">
                      <i class="fa-solid fa-circle-check"></i>
                    </span>

                    <span class="icon-red"
                      (click)="StatusConfirm(player.player_id,conditionConstants.deactive_status)"
                      pTooltip="Deactivate" tooltipPosition="top">
                      <i class="fa-solid fa-trash-can-arrow-up"></i>
                      <!-- <i class="fa-solid fa-eye"></i> -->
                      
                    </span>

                  </td>

                </tr>

              </ng-template>
            </p-table>
            <p-paginator [rows]="rows" [totalRecords]="totalData" [first]="(first - 1) * rows"
              [rowsPerPageOptions]="[10, 25,50,100]" (onPageChange)="onPageChange($event)">
            </p-paginator>


            <!-- 
        <p-sidebar [(visible)]="ShowForm" position="right" styleClass="full-width-sidebar" [modal]="true"
      [baseZIndex]="10000" [closeOnEscape]="false" appendTo="body" [showCloseIcon]="false">
 <div class="sidebar-wrapper" (click)="$event.stopPropagation()"> -->



            <p-drawer [(visible)]="ShowForm" [baseZIndex]="10000" position="right" [showCloseIcon]="false">
              <div class="d-flex justify-content-between align-items-center mb-4">

                <h3 class="small-heading">

                  {{ isEditMode ? 'Edit Player' : 'Add Player' }}
                </h3>

              </div>



              <form [formGroup]="playerRegistrationform">
                <div class="row">
                  <!-- Left Column - Input Fields -->
                  <div class="col-md-6">

                    <div class="p-3 border rounded shadow-sm h-100 bg-white">
                      <h5 class="mb-3">Player Information</h5>

                      <div class="row gy-3">
                        <div class="col-md-6">
                          <label>First Name <span class="text-danger">*</span></label>
                          <input class="form-control" type="text" maxlength="50" placeholder="Enter First Name"
                            formControlName="first_name"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('first_name', $event)">
                          <small
                            *ngIf="playerRegistrationform.get('first_name')?.invalid && (playerRegistrationform.get('first_name')?.touched || submitted)"
                            class="required-msg">First name is Required</small>
                        </div>

                        <div class="col-md-6">
                          <label>Middle Name</label>
                          <input class="form-control" type="text" maxlength="50" placeholder="Enter Middle Name"
                            formControlName="middle_name"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('middle_name', $event)">
                        </div>

                        <div class="col-md-6">
                          <label>Sure Name</label>
                          <input class="form-control" type="text" maxlength="50" placeholder="Enter Sure Name"
                            formControlName="sur_name"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('sur_name', $event)">
                        </div>

                        <div class="col-md-6">
                          <label>Display Name <span class="text-danger">*</span></label>
                          <input class="form-control" type="text" maxlength="50" placeholder="Enter Display Name"
                            formControlName="display_name"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('display_name', $event)">
                          <small
                            *ngIf="playerRegistrationform.get('display_name')?.invalid && (playerRegistrationform.get('display_name')?.touched || submitted)"
                            class="required-msg">Display name is Required</small>
                        </div>

                        <div class="col-md-6">
                          <label>Gender</label>
                          <span class="text-danger">*</span>

                          <p-dropdown [options]="genderSelect" class="drop-error " formControlName="gender_id"
                            optionValue="config_id" optionLabel="config_name" placeholder="Select Gender"
                            [panelStyleClass]="'custom-dropdown-panel'">
                            <ng-template let-gender pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ gender.config_name }}
                                </div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small
                            *ngIf="playerRegistrationform.get('gender_id')?.invalid &&(playerRegistrationform.get('gender_id')?.touched) || (playerRegistrationform.get('gender_id')?.invalid && submitted)"
                            class="required-msg"> Gender is Required
                          </small>
                        </div>



                        <div class="col-md-6">
                          <label>Player DOB</label>
                          <input class="form-control" type="date" placeholder="Enter DOB" formControlName="player_dob">
                        </div>

                        <div class="col-md-6">
                          <label>Phone No</label>
                          <input class="form-control" type="text" maxlength="10" placeholder="Enter Phone No"
                            formControlName="mobile_no" (input)="onPhoneNumberInput($event)">

                          <div
                            *ngIf="playerRegistrationform.get('mobile_no')?.touched && playerRegistrationform.get('mobile_no')?.invalid">
                            <small *ngIf="playerRegistrationform.get('mobile_no')?.errors?.['pattern']"
                              class="required-msg">
                              * Invalid mobile number
                            </small>

                          </div>
                        </div>


                        <div class="col-md-6">
                          <label>Email Id</label>
                          <input class="form-control" type="email" maxlength="100" placeholder="Enter Email"
                            formControlName="email">
                          <div
                            *ngIf="playerRegistrationform.get('email')?.touched && playerRegistrationform.get('email')?.invalid">
                            <small *ngIf="playerRegistrationform.get('email')?.errors?.['pattern']"
                              class="required-msg">
                              * Invalid email: abcd&#64;example.com
                            </small>

                          </div>
                        </div>


                        <div class="col-md-6">
                          <label>Club ID</label>
                          <span class="text-danger">*</span>
                          <p-dropdown [options]="configDataList" class="drop-error " formControlName="club_id"
                            optionValue="club_id" optionLabel="club_name" placeholder="Select Club Id">
                            <ng-template let-club pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ club.club_name }}
                                </div>
                              </div>
                            </ng-template>
                          </p-dropdown>
                          <small
                            *ngIf="playerRegistrationform?.get('club_id')?.invalid &&(playerRegistrationform?.get('club_id')?.touched) || (playerRegistrationform.get('club_id')?.invalid && submitted)"
                            class="required-msg"> Club ID is Required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>Nationality</label>
                          <span class="text-danger">*</span>

                          <p-dropdown [options]="NationalitydropdownData" formControlName="nationality_id"
                            optionValue="region_id" optionLabel="region_name" placeholder="Select Nationality Country"
                            class="drop-error" [panelStyleClass]="'custom-dropdown-panel'">

                            <ng-template let-nationality pTemplate="item">
                              <div class="flex align-items-center gap-2">
                                <div>{{ nationality.region_name }}</div>
                              </div>
                            </ng-template>
                          </p-dropdown>

                          <small *ngIf="playerRegistrationform.get('nationality_id')?.invalid && 
                              (playerRegistrationform.get('nationality_id')?.touched || submitted)"
                            class="required-msg">
                            Nationality is Required
                          </small>
                        </div>

                        <div class="col-md-6">
                          <label>Reference Sourece ID </label>
                          <input class="form-control" type="text" maxlength="20"
                            placeholder="Enter Reference Sourece ID    " formControlName="reference_id"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('reference_id', $event)">
                        </div>

                        <div class="col-md-6">
                          <label>Scorecard Name</label>
                          <input class="form-control" type="text" maxlength="50" placeholder="Enter Scorecard Name"
                            formControlName="scorecard_name"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('scorecard_name', $event)">
                        </div>

                        <div class="col-md-6">
                          <label>Jersey No</label>
                          <input class="form-control" type="number" placeholder="Enter Jersey No"
                            formControlName="jersey_no">
                        </div>

                        <!-- <div class="col-md-6">
                          <label>Team Represent</label>
                          <input class="form-control" type="text" maxlength="50" placeholder="Enter Team Represent"
                            formControlName="team_represent"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('team_represent', $event)">
                        </div> -->

                        <div class="col-md-6">
                          <label>Profile Image</label>
                          <input class="form-control" type="file" formControlName="profile_image">
                        </div>


                        <div class="col-md-6">
                          <label>Remarks</label>
                          <input class="form-control" type="text" maxlength="50" placeholder="Enter remarks"
                            formControlName="remarks"(keypress)="blockQuotesOnly($event)"
              (input)="sanitizeQuotesOnly('remarks', $event)">
                        </div>


                      </div>
                    </div>
                  </div>

                  <!-- Right Column - Radio Buttons -->

                  <div class="col-md-6">
                    <div class="box-card">
                      <div class="p-3 border rounded shadow-sm h-100 bg-white">
                        <h5 class="mb-3">Player Style & Role</h5>

                        <div class="row gy-3">

                          <!-- Player Role -->
                          <div class="col-md-6">
                            <div class="border rounded p-3"> <!-- Main box without error message inside -->
                              <label class="">Player Role <span class="text-danger">*</span></label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let role of playerrole; let i = index" class="d-flex align-items-center">
                                  <p-radiobutton name="player_role_id" [inputId]="'player_role' + i"
                                    [value]="role.config_id" formControlName="player_role_id"></p-radiobutton>
                                  <label class="ms-3" [for]="'player_role' + i">{{ role.config_name }}</label>
                                </div>
                              </div>
                            </div>

                            <!-- ERROR MESSAGE OUTSIDE THE BOX -->
                            <small *ngIf="playerRegistrationform.get('player_role_id')?.invalid &&
               (playerRegistrationform.get('player_role_id')?.touched || submitted)" class="playersrequired-msg">
                              Player Role is Required
                            </small>
                          </div>


                          <!-- Bowling Style -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label>Bowling Style</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let style of bowlingstyle; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="bowling_style_id" [inputId]="'bowling_style' + i"
                                    [value]="style.config_id" formControlName="bowling_style_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'bowling_style' + i">{{ style.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Batting Style -->
                          <div class="col-md-6">
                            <div class="border rounded p-3"> <!-- Main box without error message inside -->
                              <label>Batting Style <span class="text-danger">*</span></label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let style of battingstyle; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="batting_style_id" [inputId]="'batting_style' + i"
                                    [value]="style.config_id" formControlName="batting_style_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'batting_style' + i">{{ style.config_name }}</label>
                                </div>
                              </div>
                            </div>

                            <!-- ERROR MESSAGE OUTSIDE THE BOX -->
                            <small *ngIf="playerRegistrationform.get('batting_style_id')?.invalid &&
               (playerRegistrationform.get('batting_style_id')?.touched || submitted)" class="playersrequired-msg">
                              Batting Style is Required
                            </small>
                          </div>


                          <!-- Bowling Type -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label>Bowling Type</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let type of bowlingtype; let i = index" class="d-flex align-items-center">
                                  <p-radiobutton name="bowling_type_id" [inputId]="'bowling_type' + i"
                                    [value]="type.config_id" formControlName="bowling_type_id"
                                    (onClick)="onBowlingTypeChange(type.config_id)"></p-radiobutton>
                                  <label class="ms-2" [for]="'bowling_type' + i">{{ type.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Batting Order -->
                          <div class="col-md-6">
                            <div class="border rounded p-3">
                              <label>Batting Order</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let order of battingorder; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="batting_order_id" [inputId]="'batting_order' + i"
                                    [value]="order.config_id" formControlName="batting_order_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'batting_order' + i">{{ order.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Bowling Spec -->
                          <div class="col-md-6" *ngIf="filteredSpecs.length > 0">
                            <div class="border rounded p-3">
                              <label>Bowling Spec</label>
                              <div class="d-flex flex-column gap-1 mt-2">
                                <div *ngFor="let spec of filteredSpecs; let i = index"
                                  class="d-flex align-items-center">
                                  <p-radiobutton name="bowling_spec_id" [inputId]="'bowling_spec' + i"
                                    [value]="spec.config_id" formControlName="bowling_spec_id"></p-radiobutton>
                                  <label class="ms-2" [for]="'bowling_spec' + i">{{ spec.config_name }}</label>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div> <!-- end row -->
                      </div>
                    </div>
                  </div>


                </div>


                <div class="form-wrapper pb-5">
                  <div class="row mt-4 sticky-footer-buttons">
                    <div class="col-12 text-end">
                      <button pButton type="button" label="Cancel" class="p-button-secondary me-3"
                        (click)="cancelForm()"></button>

                      <button pButton type="button" label="Clear" class="p-button-secondary me-3"
                        *ngIf="playerRegistrationform.get('player_id')?.value == '' || playerRegistrationform.get('player_id')?.value == null"
                        (click)="resetForm()"></button>

                      <button pButton type="button" label="Save" class="save-button"
                        (click)="duplicateChange()"></button>
                    </div>
                  </div>
                </div>





              </form>

              <p-dialog header="Duplicate Player Found" [modal]="true" [(visible)]="visible"
                [style]="{ width: '60rem', 'border-radius': '10px' }" [contentStyle]="{ 'padding': '1.5rem' }"
                styleClass="custom-duplicate-dialog">

                <div style="font-weight: bold; font-size: 1.5rem; margin-bottom: 1rem; text-align: center;">
                  Similar Player(s) Already Exist!
                </div>

                <p-table [value]="duplicatePlayers" [globalFilterFields]="['display_name']" [paginator]="true"
                  [rows]="5" styleClass="p-datatable-gridlines">

                  <ng-template pTemplate="header">
                    <tr>
                      <th pSortableColumn="display_name">Player Name <p-sortIcon field="display_name"></p-sortIcon></th>
                      <th pSortableColumn="gender">Gender <p-sortIcon field="gender"></p-sortIcon></th>
                      <th pSortableColumn="player_role">Role <p-sortIcon field="player_role"></p-sortIcon></th>
                      <th pSortableColumn="batting_style">Batting Style <p-sortIcon field="batting_style"></p-sortIcon>
                      </th>
                      <th pSortableColumn="bowling_style">Bowling Style <p-sortIcon field="bowling_style"></p-sortIcon>
                      </th>
                      <th pSortableColumn="bowling_type">Bowling Type <p-sortIcon field="bowling_type"></p-sortIcon>
                      </th>
                      <th pSortableColumn="bowling_specialization">Specialization <p-sortIcon
                          field="bowling_specialization"></p-sortIcon></th>
                      <th pSortableColumn="batting_order">Order <p-sortIcon field="batting_order"></p-sortIcon></th>
                    </tr>
                  </ng-template>

                  <ng-template pTemplate="body" let-player let-even="even">
                    <tr [ngClass]="{ 'p-highlight': even }">
                      <td>{{ player.display_name }}</td>
                      <td>{{ player.gender }}</td>
                      <td>{{ player.player_role }}</td>
                      <td>{{ player.batting_style }}</td>
                      <td>{{ player.bowling_style }}</td>
                      <td>{{ player.bowling_type }}</td>
                      <td>{{ player.bowling_specialization }}</td>
                      <td>{{ player.batting_order }}</td>
                    </tr>
                  </ng-template>
                </p-table>

                <!-- Footer -->
                <ng-template pTemplate="footer">
                  <div class="row mt-4 sticky-footer-buttons">
                    <div class="col-12 text-end">
                      <button pButton type="button" label="Cancel" class="" (click)="hideDialog()"></button>


                      <button pButton type="button" label="Add" class="save-button" (click)="addplayerdata()"></button>

                    </div>
                  </div>

                </ng-template>








              </p-dialog>




              <!-- </div> -->
              <!-- </p-sidebar> -->
            </p-drawer>
          </div>
        </div>
      </main>
    </div>
  </div>


</div>

<p-toast key="tc" position="top-right"></p-toast>