<div class="parent-container">
  <button class="new-button p-button-text Comp-child-butn" (click)="addplayer()">UpdatePlayer</button>
</div>

<div style="display: flex; gap: 2rem;">

  <div
    style="display: flex; background-color: white; padding: 6px; border-radius: 3px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
    <!-- Left: Team List -->
    <div style="width: 200px;">
      <div style="text-align:center; font-weight: bold; ">Select Team</div>

      <div *ngFor="let team of teamsDropDown" class="team-card" [ngClass]="{ 'selected': team.team_id === team_id }"
        (click)="chooseTeam(team.team_id)">

        {{ team.team_name }}
      </div>
    </div>
  </div>
  <div style="flex: 1;">
    <p-pickList [source]="sourcePlayer" [target]="targetPlayer" [dragdrop]="true" [responsive]="true"
      [showSourceFilter]="true" [showTargetFilter]="true" filterBy="display_name"
      sourceFilterPlaceholder="Search Available..." targetFilterPlaceholder="Search Selected Player..."
      [sourceStyle]="{ height: '30rem' }" [targetStyle]="{ height: '30rem' }" (onMoveToTarget)="onMoveToTarget($event)"
      (onMoveToSource)="onMoveToSource($event)" (onMoveAllToSource)="onMoveAllToTarget($event)">

      <ng-template pTemplate="sourceHeader">
        <div class="p-d-flex p-ai-center">
          Available Player
        </div>
      </ng-template>

      <ng-template pTemplate="targetHeader">
        <div class="p-d-flex p-ai-center">
          Selected Player
        </div>
      </ng-template>


      <ng-template pTemplate="targetItem" let-player>
        <div style="padding: 8px;">
          {{ player.display_name }}
        </div>
      </ng-template>

      <ng-template pTemplate="item" let-player let-i="index">
        <div class="flex flex-wrap p-2 align-items-center gap-3" [ngClass]="{ 'highlight-target': player.highlighted }">
          <div class="flex-1 flex flex-column gap-2">
            <span class="person-image-team-player">
              <img class="player-img" *ngIf="!player.profile_img || !player.player_profile" [src]="default_img">

              <img class="player-img" *ngIf="player.profile_img && player.player_profile" [src]="player.profile_img"
                (error)="handleImageError($event, default_img)">
            </span>
            <span class="font-bold">{{ player.display_name }}</span>
          <span *ngIf="TeamInTarget(player)">
          <button class="clear-width edit-button" (click)="showEditPopup(player)"> <i class="fas fa-edit"></i></button>
        </span>

          </div>
        </div>
      </ng-template>

    </p-pickList>
  </div>
</div>
<!-- POPUP SCREEN  -->
<div *ngIf="isEditPopupVisible" class="popup-backdrop">
  <div class="popup-wrapper">

    <div class="popup">

      <form [formGroup]="ManagePlayerForm" class="p-4 border rounded shadow-sm bg-white">
        <div class="mb-3 d-flex align-items-center" style="background-color: #b1ceec;">
          <div>
            <span class="person-image-team-player">
              <img class="player-img" *ngIf="!selectedPlayer?.profile_url" [src]="default_img" style="    width: 52px;
             height: 52px;">

              <img class="player-img" *ngIf="selectedPlayer?.profile_url" [src]="selectedPlayer.profile_url"
                (error)="handleImageError($event, default_img)" style="    width: 52px;
    height: 52px;">
            </span>
          </div>
          <div class="ms-2 fw-bold fs-6">
            {{ ManagePlayerForm.get('display_name')?.value | uppercase }}
          </div>
        </div>

        <!-- Scorecard Name Input -->
        <div class="mb-3 d-flex align-items-center">
          <label for="jersey_number" class="form-label fw-semibold me-2 mb-0" style="min-width: 105px;">
            Jersey Number :
          </label>
          <input id="jersey_number" type="text" class="form-control" formControlName="jersey_number" />
        </div>

        <!-- Sponsor Name Input -->
        <div class="mb-3 d-flex align-items-center">
          <label for="scorecard_name" class="form-label fw-semibold me-2 mb-0" style="min-width: 105px;">
            Scorecard Name :
          </label>
          <input id="scorecard_name" type="text" class="form-control" formControlName="scorecard_name" />
        </div>

        <!-- Buttons -->
        <div class="text-end">
          <button type="submit" class="btn btn-primary save-button" (click)="updateplayer()">
            Submit
          </button>
          <button type="button" class="btn btn-secondary ms-2 custom-cancel-btn" (click)="closeEditPopup()">
            Close
          </button>
        </div>
      </form>

    </div>
  </div>
</div>