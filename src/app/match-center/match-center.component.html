<!-- --Match Center Header ---->
<div class="row match-center-header" *ngIf="!ShowPointsForm && !showScorecard">
  <!-- Left: Title -->
  <div class="col-4">
    <h2 class="heading">Match Center</h2>
  </div>
  <!-- Right: Filters -->
  <div class="col-8 ">
    <div class="row">
      <!-- Status Dropdown -->
      <div class="col-2 col-main-dropdown">
        <p-dropdown [options]="statuses" [(ngModel)]="selectedStatus" optionLabel="label" optionValue="value"
          placeholder="Select Status" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>

      <!-- Gender Dropdown -->
      <div class="col-2 col-main-dropdown">
        <p-dropdown [options]="genders" [(ngModel)]="selectedGender" optionLabel="label" optionValue="value"
          placeholder="Select Gender" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>

      <!-- Age Group Dropdown -->
      <div class="col-2 col-main-dropdown">
        <p-dropdown [options]="ageGroups" [(ngModel)]="selectedAgeGroup" optionLabel="label" optionValue="value"
          placeholder="Select Age Group" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>

      <!-- Match Type Dropdown -->
      <div class="col-2 col-main-dropdown">
        <p-dropdown [options]="matchTypes" [(ngModel)]="selectedMatchType" optionLabel="label" optionValue="value"
          placeholder="Select Match Type" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>

      <!-- Team Format Dropdown (optional) -->
      <div class="col-2 col-main-dropdown">
        <p-dropdown [options]="teamFormats" [(ngModel)]="selectedTeamFormat" optionLabel="label" optionValue="value"
          placeholder="Select Team Format" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>


    </div>
  </div>
</div>
<!-- --Match Cards Grid ---->
<div *ngIf="!ShowPointsForm && !showScorecard" class="row match-center-body">
  <div class="col-12 match-grid">
    <!-- If filtered matches exist -->
    <ng-container *ngIf="paginatedMatches.length > 0; else noData">
      <div class="match-card" *ngFor="let match of paginatedMatches">
        <!-- Card Image -->
        <div class="card-image">
          <!-- <img src="assets/images/Flash Light.jpeg" alt="Flash Light"> -->
        </div>

        <!-- Top Row: Match Type | Dates | Status -->
        <div class="top-row">
          <div class="match-type">{{ match.matchType }}</div>
          <div class="match-dates">{{ match.startDate }} – {{ match.endDate }}</div>
          <div class="status">{{ match.status }}</div>
        </div>
        <!-- Series Name -->
        <div class="series-name-container">
          <div class="series-name">{{ match.series }}</div>
        </div>
        <!-- Series Match Counts -->
        <div class="series-match-counts">
          <ng-container *ngFor="let type of getMatchTypeCounts(match.series) | keyvalue">
            <span class="count-badge" (click)="showPointsForm(match.series, type.key)">
              {{ type.key }}: {{ type.value }}
            </span>
          </ng-container>
        </div>
        <!-- Points Button (if series has points) -->
        <button *ngIf="hasPoints(match.series)" class="points-btn" (click)="showPointsForm(match.series)">
          Points
        </button>
      </div>
    </ng-container>
    <!-- No data template -->
    <ng-template #noData>
      <div class="match-card no-data-card">
        <p>No Matches Found</p>
      </div>
    </ng-template>
  </div>
  <!-- Paginator -->
  <div class="match-cardpaginator-container">
    <p-paginator [rows]="rows" [totalRecords]="totalData" [first]="first" [rowsPerPageOptions]="[6, 12, 18]"
      (onPageChange)="onPageChange($event)">
    </p-paginator>
  </div>
</div>
<!-- --Points Form (Full Page) ---->
<div *ngIf="ShowPointsForm && !showScorecard" class="points-form-fullpage">
  <form [formGroup]="pointsForm">
    <div class="match-center">
      <h2 class="heading2">Fixtures & Results</h2>
      <!-- Matches List -->
      <div class="matches-list">
        <div class="match-row mt-1" *ngFor="let match of schedulesList">
          <!-- Left Side: Match Info -->
          <div class="left-info">
            <h6>
              <div class="head">{{ match.competitionName }}</div>
            </h6>
            <div class="date">{{ match.startDate }}</div>
            <div class="series">{{ match.matchType }}</div>
            <div class="venue">{{ match.venue }}</div>
          </div>
          <!-- Teams Section -->
          <div class="teams">
            <!-- Team A -->
            <div class="team left-team">
              <span class="team-name">{{ match.teamA }}</span>
              <img [src]="" />
              <div class="team-score">
                <!-- Test Match: Show Multiple Innings -->
                <ng-container *ngIf="match.matchType === 'Multiday'; else singleScoreA">
                  <div class="innings-row">
                    <div class="innings-header">
                      <span *ngFor="let inn of match.teamASummary; let i = index" class="innings-col">
                      Inn {{ i + 1 }}
                      </span>
                    </div>
                    <div class="innings-score">
                      <span *ngFor="let inn of match.teamASummary" class="score-text innings-col">
                        {{ inn.split('(')[0].trim() }}
                      </span>
                    </div>
                    <div class="innings-overs">
                      <span *ngFor="let inn of match.teamASummary" class="overs-text innings-col">
                        ({{ inn.split('(')[1] ? inn.split('(')[1].replace(')', '') : '' }})
                      </span>
                    </div>
                  </div>
                </ng-container>

                <!-- Non-Test Score -->
                <ng-template #singleScoreA>
                  <ng-container *ngIf="match.teamASummary; else yetToBatA">
                    <span class="score-text">{{ match.teamASummary.split(' ')[0] }}</span><br>
                    <small class="overs-text">{{ match.teamASummary.split(' ')[1] || '' }}</small>
                  </ng-container>
                  <ng-template #yetToBatA>
                    {{ match.teamASummary || 'Yet to Bat' }}
                  </ng-template>
                </ng-template>
              </div>
            </div>
            <!-- VS Icon -->
            <div>
              <span><img src="assets/images/game.png" width="50" height="50"></span>
            </div>
            <!-- Team B -->
            <div class="team right-team">
              <div class="team-score">
                <!-- Test Match -->
                <ng-container *ngIf="match.matchType === 'Multiday'; else singleScoreB">
                  <div class="innings-row">
                    <div class="innings-header">
                      <span *ngFor="let inn of match.teamBSummary; let i = index" class="innings-col">
                        Inn {{ i + 1 }}
                      </span>
                    </div>
                    <div class="innings-score">
                      <span *ngFor="let inn of match.teamBSummary" class="score-text innings-col">
                        {{ inn.split('(')[0].trim() }}
                      </span>
                    </div>
                    <div class="innings-overs">
                      <span *ngFor="let inn of match.teamBSummary" class="overs-text innings-col">
                        ({{ inn.split('(')[1] ? inn.split('(')[1].replace(')', '') : '' }})
                      </span>
                    </div>
                  </div>
                </ng-container>

                <!-- Non-Test Score -->
                <ng-template #singleScoreB>
                  <ng-container *ngIf="match.teamBSummary; else yetToBatB">
                    <span class="score-text">{{ match.teamBSummary.split(' ')[0] }}</span><br>
                    <small class="overs-text">{{ match.teamBSummary.split(' ')[1] || '' }}</small>
                  </ng-container>
                  <ng-template #yetToBatB>
                    {{ match.teamBSummary || 'Yet to Bat' }}
                  </ng-template>
                </ng-template>
              </div>
              <img [src]="" />
              <span class="team-name">{{ match.teamB }}</span>
            </div>
          </div>
          <!-- Match Result Status -->
          <div class="result-status" *ngIf="match.result">
            <strong>{{ match.result }}</strong>
          </div>
          <!-- Match Center Button -->
          <div class="right-btn">
            <button class="match-btn" (click)="openScorecard(match)">Match Centre →</button>
          </div>
        </div>
      </div>
        <!-- Paginator Ponints -->
      <div class="match-cardpaginator-container">
        <p-paginator [rows]="pointsRows" [totalRecords]="filteredPointsMatches.length" [first]="pointsFirst"
          [rowsPerPageOptions]="[5, 10, 15]" (onPageChange)="onPointsPageChange($event)">
        </p-paginator>
      </div>
    </div>

    <!-- Cancel Button (Common) -->
    <div class="form-actions">
      <button type="button" (click)="closePointsForm()">Back</button>
    </div>
  </form>
</div>


<!-- --SCORECARD ---->
<div *ngIf="showScorecard" class="points-form-fullpage">

  <!-- Match Header -->
  <div class="match-center">
    <h2 class="heading2">Result</h2>
    <div class="matches-list">
      <div class="match-row">
        <div class="left-info">
          <h6>
            <div class="head">{{ selectedMatch.competitionName }}</div>
          </h6>
          <div class="date">{{ selectedMatch.startDate }}</div>
          <div class="series">{{ selectedMatch.matchType }}</div>
          <div class="venue">{{ selectedMatch.venue }}</div>
        </div>
        <div class="teams">
          <!-- Reusable Team Block -->
          <ng-container
            *ngTemplateOutlet="teamBlock; context:{ team: selectedMatch.teamA, side:'left' }"></ng-container>

           
          <!-- VS Icon -->
          <div><img src="assets/images/game.png" width="50" height="50" /></div>
          <!-- Reusable Team Block -->
          <ng-container
            *ngTemplateOutlet="teamBlock; context:{ team: selectedMatch.teamB, side:'right' }"></ng-container>
            
        </div>
        <div class="sresult-status" *ngIf="selectedMatch.result">
          <strong>{{ selectedMatch.result }}</strong>
        </div>
      </div>
    </div>
  </div>
  <!-- Back Button -->
  <div class="form-actions">
    <button type="button" (click)="closeScorecard()">Back</button>
  </div>
  <!-- Tabs -->
  <h2 class="heading3">Score Details</h2>
  <div class="scorecard-container">
    <div class="tabs">
      <span class="tab" (click)="activeTab='scorecard'"
        [ngClass]="{ activeTab: activeTab==='scorecard' }">Scorecard</span>
      <span class="tab" (click)="activeTab='squad'" [ngClass]="{ activeTab: activeTab==='squad' }">Squad</span>
      <span class="tab" (click)="activeTab='videos'" [ngClass]="{ activeTab: activeTab==='videos' }">Videos</span>
    </div>
    <!--  innings button -->
    <div class="innings-button" *ngIf="selectedMatch.matchType !== 'Multiday'">
      <button class="innings-one" (click)="activeinnings='one'" [ngClass]="{ activetab: activeinnings=== 'one'}">1st
        Inns {{ selectedMatch.teamASummary }}</button>
      <button class="innings-two" (click)="activeinnings='two'" [ngClass]="{ activetab: activeinnings=== 'two'}">2nd
        Inns {{ selectedMatch.teamBSummary }}</button>
     </div>
     <!-- Test match innings button -->
    <div class="test-innings-button" *ngIf="selectedMatch.matchType === 'Multiday'">
      <button class="innings-one" (click)="activeInnings='testone'"
        [ngClass]="{ activetab: activeInnings=== 'testone'}">1st Inns {{ selectedMatch.teamASummary }}</button>
      <button class="innings-two" (click)="activeInnings='testtwo'"
        [ngClass]="{ activetab: activeInnings=== 'testtwo'}">2nd Inns {{ selectedMatch.teamBSummary }}</button>
      <button class="innings-one" (click)="activeInnings='testthird'"
        [ngClass]="{ activetab: activeInnings=== 'testthird'}">1st Inns {{ selectedMatch.teamASummary }}</button>
      <button class="innings-two" (click)="activeInnings='testfour'"
        [ngClass]="{ activetab: activeInnings=== 'testfour'}">2nd Inns {{ selectedMatch.teamBSummary }}</button>
     </div>

    <!-- Scorecard Tab -->
<div *ngIf="activeTab==='scorecard'">

      <!-- Scorecard tables for both teams visible by default -->
      <div class="scorecard-teams-visible" *ngIf="selectedMatch.type !== 'upcoming'">

        <!-- Team A Batting & Team B Bowling -->
        <div class="team-scorecard" *ngIf="selectedMatch.matchType !== 'Multiday' && activeinnings === 'one'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA }} Batting</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: battingSummaries }"></ng-container>
        </div>

        <!-- fall of wickets -->
        <div class="fall-of-wickets" *ngIf="selectedMatch.matchType !== 'Multiday' && activeinnings === 'one'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

        <div class="team-scorecard" *ngIf="selectedMatch.matchType !== 'Multiday' && activeinnings === 'one'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamBbowling }"></ng-container>
        </div>

        <!-- Team B Batting & Team A Bowling -->
        <div class="team-scorecard" *ngIf="selectedMatch.matchType !== 'Multiday' && activeinnings === 'two'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB }} Batting</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: battingSummaries }"></ng-container>
        </div>

         <!-- fall of wickets -->
        <div class="fall-of-wickets" *ngIf="selectedMatch.matchType !== 'Multiday' && activeinnings === 'two'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

        <div class="team-scorecard" *ngIf="selectedMatch.matchType !== 'Multiday' && activeinnings === 'two'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamAbowling }"></ng-container>
        </div>
      </div>

                                <!--Test Match Inngings  -->
      <div class="scorecard-teams-visible"
        *ngIf="selectedMatch.type !== 'upcoming' && selectedMatch.matchType === 'Multiday'">

        <!-- Team A Batting & Team B Bowling first inngings-->
        <div class="team-scorecard" *ngIf="activeInnings === 'testone'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA }} Batting 1st inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: battingSummaries }"></ng-container>
        </div>

        <!-- fall of wickts -->
        <div class="fall-of-wickets" *ngIf=" activeInnings === 'testone'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

        <div class="team-scorecard" *ngIf="activeInnings === 'testone'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: bowlingSummaries }"></ng-container>
        </div>
        
         <!-- Team B Batting & Team A Bowling first Inngings -->
        <div class="team-scorecard" *ngIf="activeInnings === 'testtwo'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB }} Batting 1st inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: battingSummaries }"></ng-container>
        </div>

        <div class="fall-of-wickets" *ngIf=" activeInnings === 'testtwo'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

          <div class="team-scorecard" *ngIf="activeInnings === 'testtwo'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: bowlingSummaries }"></ng-container>
        </div>

        <!-- Team A Batting & Team B Bowling second inngings-->
        <div class="team-scorecard" *ngIf="activeInnings === 'testthird'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA }} Batting 2nd inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: battingSummaries }"></ng-container>
        </div>

        <div class="fall-of-wickets" *ngIf=" activeInnings === 'testthird'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

          <div class="team-scorecard" *ngIf="activeInnings === 'testthird'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: bowlingSummaries }"></ng-container>
        </div>

                <!-- Team B Batting & Team A Bowling second Inngings -->
        <div class="team-scorecard" *ngIf="activeInnings === 'testfour'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB }} Batting 2nd inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: battingSummaries }"></ng-container>
        </div>

         <div class="fall-of-wickets" *ngIf=" activeInnings === 'testfour'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

          <div class="team-scorecard" *ngIf="activeInnings === 'testfour'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: bowlingSummaries }"></ng-container>
        </div>
    </div>
      <!-- Fall of wickets -->
        <ng-template #fallOfWicketTable let-wickets="wickets">
          <div class="table-scroll">
          <table class="scorecard-table">
            <thead>
              <tr>
                <th>Batter</th>
                <th>Score</th>
                <th>Over</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let w of wickets">
                <td>{{ w.playerName }}</td>
                <td>{{ w.teamTotal }}</td>
                <td>{{ w.overValue }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        </ng-template>
    
      <div class="total-score-display" *ngIf="selectedMatch.type !== 'upcoming'">
        <div>
          <!-- <span>Total Score - <strong>{{selectedMatch.teamA.score}}</strong></span> -->
          <!-- <span>Extras : </span> -->
        </div>
      </div>
    </div>
    <!-- Squad Tab -->
    <div *ngIf="activeTab==='squad'">
      <!-- Show Both Teams' Squads by default -->
      <div class="squad-teams-visible">
        <!-- Team A Squad -->
        <div class="team-squad">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA }} Squad</span>
          <ng-container *ngTemplateOutlet="squadTable; context:{ players: teamAsquad }"></ng-container>
        </div>
        <!-- Team B Squad -->
        <div class="team-squad">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB }} Squad</span>
          <ng-container *ngTemplateOutlet="squadTable; context:{ players: teamBsquad }"></ng-container>
        </div>
      </div>
    </div>
    <!-- Reusable Squad Table Template -->
    <ng-template #squadTable let-players="players">
      <div class="table-scroll">
        <table class="scorecard-table">
          <thead>
            <tr>
              <th>Player</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let player of players">
              <td>{{ player }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-template>
    <!-- Videos Tab -->
    <div *ngIf="activeTab==='videos'">
      <p>Videos Not Available Right now.....</p>
    </div>
  </div>
  <!-- Match Details (ONLY SHOW ON SCORECARD) -->

</div>

<!-- --Reusable Team Block ---->
<ng-template #teamBlock let-team="team" let-side="side">
  <div class="team" [ngClass]="side+'-team'">
    <span class="team-name">{{ team }}</span>
    <img [src]="team.logo" />
    <div class="team-score">
      <ng-container *ngIf="selectedMatch.matchType==='Multiday'; else normalScore">
        <div class="innings-row">
          <div class="innings-header">
            <span *ngFor="let inn of team.innings; let i=index" class="innings-col">Inn {{ i+1 }}</span>
          </div>
          <div class="innings-score">
            <span *ngFor="let inn of team.innings" class="score-text innings-col">{{ inn.split('(')[0].trim() }}</span>
          </div>
          <div class="innings-overs">
            <span *ngFor="let inn of team.innings" class="overs-text innings-col">
              ({{ inn.split('(')[1] ? inn.split('(')[1].replace(')','') : '' }})
            </span>
          </div>
        </div>
      </ng-container>
      <ng-template #normalScore>
        <ng-container *ngIf="team.score; else yetToBat">
          <span class="score-text">{{ team.score.split(' ')[0] }}</span><br>
          <small class="overs-text">{{ team.score.split(' ')[1] || '' }}</small>
        </ng-container>
        <ng-template #yetToBat>{{ team.score || 'Yet to Bat' }}</ng-template>
      </ng-template>
    </div>
  </div>
</ng-template>

<!-- --Reusable Batting Table ---->
<ng-template #battingTable let-batters="batters">
  <div class="table-scroll">
    <table class="scorecard-table">
      <thead>
        <tr>
          <th>Batter</th>
          <th>R</th>
          <th>B</th>
          <th>4s</th>
          <th>6s</th>
          <th>SR</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let batter of batters">
          <td>{{ batter.playerName }}</td>
          <td>{{ batter.runs }}</td>
          <td>{{ batter.balls }}</td>
          <td>{{ batter.fours }}</td>
          <td>{{ batter.sixes }}</td>
          <td>{{ batter.strikeRate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-template>

<!-- --Reusable Bowling Table ---->
<ng-template #bowlingTable let-bowlers="bowlers">
  <div class="table-scroll">
    <table class="scorecard-table">
      <thead>
        <tr>
          <th>Bowler</th>
          <th>O</th>
          <th>M</th>
          <th>R</th>
          <th>W</th>
          <th>ER</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let bowler of bowlers">
          <td>{{ bowler.playerName }}</td>
          <td>{{ bowler.overs }}</td>
          <td>{{ bowler.maidens }}</td>
          <td>{{ bowler.runs }}</td>
          <td>{{ bowler.wickets }}</td>
          <td>{{ bowler.economy }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-template>