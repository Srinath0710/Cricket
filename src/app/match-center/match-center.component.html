<!-- --Match Center Header ---->
<!-- --Match Center Header ---->
<div class="row match-center-header" *ngIf="!ShowPointsForm && !showScorecard">
  <!-- Left: Title -->
  <div class="col-4">
    <h2 class="heading">Match Center</h2>
  </div>

  <!-- Right: Filters -->
  <div class="col-8">
    <div class="row">
      <!-- Status Dropdown -->
      <div class="col-3">
        <p-dropdown [options]="statuses" [(ngModel)]="selectedStatus" optionLabel="label" optionValue="value"
          placeholder="Select Status" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>

      <!-- Gender Dropdown -->
      <div class="col-3">
        <p-dropdown [options]="genders" [(ngModel)]="selectedGender" optionLabel="label" optionValue="value"
          placeholder="Select Gender" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>

      <!-- Age Group Dropdown -->
      <div class="col-3">
        <p-dropdown [options]="ageGroups" [(ngModel)]="selectedAgeGroup" optionLabel="label" optionValue="value"
          placeholder="Select Age Group" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>

      <!-- Match Type Dropdown -->
      <div class="col-3">
        <p-dropdown [options]="matchTypes" [(ngModel)]="selectedMatchType" optionLabel="label" optionValue="value"
          placeholder="Select Match Type" styleClass="fixed-dropdown">
        </p-dropdown>
      </div>
    </div>
  </div>
</div>



<!-- --Match Cards Grid ---->
<div *ngIf="!ShowPointsForm && !showScorecard" class="row match-center-body">
  <div class="col-12 match-grid">
    <!-- If filtered matches exist -->
    <ng-container *ngIf="paginatedMatches.length > 0; else noData">
      <div class="match-card" *ngFor="let match of paginatedMatches">

        <!-- Card Image -->
        <div class="card-image">
          <!-- <img src="assets/images/Flash Light.jpeg" alt="Flash Light"> -->
        </div>

        <!-- Top Row: Match Type | Dates | Status -->
        <div class="top-row">
          <div class="match-type">{{ match.matchType }}</div>
          <div class="match-dates">{{ match.startDate }} – {{ match.endDate }}</div>
          <div class="status">{{ match.status }}</div>
        </div>

        <!-- Series Name -->
        <div class="series-name-container">
          <div class="series-name">{{ match.series }}</div>
        </div>

        <!-- Series Match Counts -->
        <div class="series-match-counts">
          <ng-container *ngFor="let type of getMatchTypeCounts(match.series) | keyvalue">
            <span class="count-badge" (click)="showPointsForm(match.series, type.key)">
              {{ type.key }}: {{ type.value }}
            </span>
          </ng-container>
        </div>

        <!-- Points Button (if series has points) -->
        <button *ngIf="hasPoints(match.series)" class="points-btn" (click)="showPointsForm(match.series)">
          Points
        </button>
      </div>
    </ng-container>

    <!-- No data template -->
    <ng-template #noData>
      <div class="match-card no-data-card">
        <p>No Matches Found</p>
      </div>
    </ng-template>
  </div>


  <!-- Paginator -->
  <div class="paginator-container">
    <p-paginator [rows]="rows" [totalRecords]="totalData" [first]="first" [rowsPerPageOptions]="[6, 12, 18]"
      (onPageChange)="onPageChange($event)">
    </p-paginator>
  </div>
</div>

<!-- --Points Form (Full Page) ---->
<div *ngIf="ShowPointsForm && !showScorecard" class="points-form-fullpage">
  <form [formGroup]="pointsForm">

    <div class="match-center">
      <h2 class="heading2">Fixtures & Results</h2>

      <!-- Matches List -->
      <div class="matches-list">
        <div class="match-row" *ngFor="let match of paginatedPointsMatches">

          <!-- Left Side: Match Info -->
          <div class="left-info">
            <h6>
              <div class="head">{{ match.series }}</div>
            </h6>
            <div class="date">{{ match.dateTime }}</div>
            <div class="series">{{ match.matchType }}</div>
            <div class="venue">{{ match.stadium }}, {{ match.location }}</div>
          </div>

          <!-- Teams Section -->
          <div class="teams">

            <!-- Team A -->
            <div class="team left-team">
              <span class="team-name">{{ match.teamA.name }}</span>
              <img [src]="match.teamA.logo" />

              <div class="team-score">
                <!-- Test Match: Show Multiple Innings -->
                <ng-container *ngIf="match.matchType === 'Test'; else singleScoreA">
                  <div class="innings-row">
                    <div class="innings-header">
                      <span *ngFor="let inn of match.teamA.innings; let i = index" class="innings-col">
                        Inn {{ i + 1 }}
                      </span>
                    </div>
                    <div class="innings-score">
                      <span *ngFor="let inn of match.teamA.innings" class="score-text innings-col">
                        {{ inn.split('(')[0].trim() }}
                      </span>
                    </div>
                    <div class="innings-overs">
                      <span *ngFor="let inn of match.teamA.innings" class="overs-text innings-col">
                        ({{ inn.split('(')[1] ? inn.split('(')[1].replace(')', '') : '' }})
                      </span>
                    </div>
                  </div>
                </ng-container>

                <!-- Non-Test Score -->
                <ng-template #singleScoreA>
                  <ng-container *ngIf="match.teamA.score; else yetToBatA">
                    <span class="score-text">{{ match.teamA.score.split(' ')[0] }}</span><br>
                    <small class="overs-text">{{ match.teamA.score.split(' ')[1] || '' }}</small>
                  </ng-container>
                  <ng-template #yetToBatA>
                    {{ match.teamA.score || 'Yet to Bat' }}
                  </ng-template>
                </ng-template>
              </div>
            </div>

            <!-- VS Icon -->
            <div>
              <span><img src="assets/images/game.png" width="50" height="50"></span>
            </div>

            <!-- Team B -->
            <div class="team right-team">
              <div class="team-score">
                <!-- Test Match -->
                <ng-container *ngIf="match.matchType === 'Test'; else singleScoreB">
                  <div class="innings-row">
                    <div class="innings-header">
                      <span *ngFor="let inn of match.teamB.innings; let i = index" class="innings-col">
                        Inn {{ i + 1 }}
                      </span>
                    </div>
                    <div class="innings-score">
                      <span *ngFor="let inn of match.teamB.innings" class="score-text innings-col">
                        {{ inn.split('(')[0].trim() }}
                      </span>
                    </div>
                    <div class="innings-overs">
                      <span *ngFor="let inn of match.teamB.innings" class="overs-text innings-col">
                        ({{ inn.split('(')[1] ? inn.split('(')[1].replace(')', '') : '' }})
                      </span>
                    </div>
                  </div>
                </ng-container>

                <!-- Non-Test Score -->
                <ng-template #singleScoreB>
                  <ng-container *ngIf="match.teamB.score; else yetToBatB">
                    <span class="score-text">{{ match.teamB.score.split(' ')[0] }}</span><br>
                    <small class="overs-text">{{ match.teamB.score.split(' ')[1] || '' }}</small>
                  </ng-container>
                  <ng-template #yetToBatB>
                    {{ match.teamB.score || 'Yet to Bat' }}
                  </ng-template>
                </ng-template>
              </div>

              <img [src]="match.teamB.logo" />
              <span class="team-name">{{ match.teamB.name }}</span>
            </div>
          </div>

          <!-- Match Result Status -->
          <div class="result-status" *ngIf="match.resultStatus">
            <strong>{{ match.resultStatus }}</strong>
          </div>

          <!-- Match Center Button -->
          <div class="right-btn">
            <button class="match-btn" (click)="openScorecard(match)">Match Centre →</button>
          </div>
        </div>
      </div>
      <div>
        <!-- Paginator Ponints -->
        <p-paginator [rows]="pointsRows" [totalRecords]="filteredPointsMatches.length" [first]="pointsFirst"
          [rowsPerPageOptions]="[5, 10, 15]" (onPageChange)="onPointsPageChange($event)">
        </p-paginator>
      </div>
    </div>

    <!-- Cancel Button (Common) -->
    <div class="form-actions">
      <button type="button" (click)="closePointsForm()">Cancel</button>
    </div>

  </form>
</div>






<!-- --SCORECARD ---->
<div *ngIf="showScorecard" class="points-form-fullpage">
  <!-- Match Header -->
  <div class="match-center">
    <div class="matches-list">
      <div class="match-row">
        <div class="left-info">
          <h6>
            <div class="head">{{ selectedMatch.series }}</div>
          </h6>
          <div class="date">{{ selectedMatch.dateTime }}</div>
          <div class="series">{{ selectedMatch.matchType }}</div>
          <div class="venue">{{ selectedMatch.stadium }}, {{ selectedMatch.location }}</div>
        </div>

        <div class="teams">
          <!-- Reusable Team Block -->
          <ng-container *ngTemplateOutlet="teamBlock; context:{ team: selectedMatch.teamA, side:'left' }"></ng-container>

          <!-- VS Icon -->
          <div><img src="assets/images/game.png" width="50" height="50" /></div>

          <!-- Reusable Team Block -->
          <ng-container *ngTemplateOutlet="teamBlock; context:{ team: selectedMatch.teamB, side:'right' }"></ng-container>
        </div>

        <div class="sresult-status" *ngIf="selectedMatch.resultStatus">
          <strong>{{ selectedMatch.resultStatus }}</strong>
        </div>
      </div>
    </div>
  </div>



  <!-- Back Button -->
  <div class="form-actions">
    <button type="button" (click)="closeScorecard()">Back</button>
  </div>

  <!-- Tabs -->
  <div class="scorecard-container">
    <div class="tabs">
      <span class="tab" (click)="activeTab='scorecard'" [ngClass]="{ activeTab: activeTab==='scorecard' }">Scorecard</span>
      <span class="tab" (click)="activeTab='squad'" [ngClass]="{ activeTab: activeTab==='squad' }">Squad</span>
      <span class="tab" (click)="activeTab='videos'" [ngClass]="{ activeTab: activeTab==='videos' }">Videos</span>
    </div>
    <!-- Test match innings button -->
     <div class="innings-button" *ngIf="selectedMatch.matchType === 'Test'">
        <button class="innings-one" (click)="activeinnings='one'" [ngClass]="{ activetab: activeinnings=== 'one'}">1st Inns</button>
        <button class="innings-two" (click)="activeinnings='two'" [ngClass]="{ activetab: activeinnings=== 'two'}">2nd Inns</button>
     </div>



    <!-- Scorecard Tab -->
<div *ngIf="activeTab==='scorecard'">

      <!-- Scorecard tables for both teams visible by default -->
      <div class="scorecard-teams-visible" *ngIf="selectedMatch.type !== 'upcoming'">

        <!-- Team A Batting & Team B Bowling -->
        <div class="team-scorecard" *ngIf="selectedMatch.matchType !== 'Test'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA.name }} Batting</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: teamAbatting }"></ng-container>

          <span class="TeamsScoreFont">{{ selectedMatch.teamB.name }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamBbowling }"></ng-container>
        </div>


        <!-- fall of wickets -->
        <div class="fall-of-wickets" *ngIf="selectedMatch.matchType !== 'Test'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

        <!-- Team B Batting & Team A Bowling -->
        <div class="team-scorecard" *ngIf="selectedMatch.matchType !== 'Test'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB.name }} Batting</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: teamBbatting }"></ng-container>

          <span class="TeamsScoreFont">{{ selectedMatch.teamA.name }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamAbowling }"></ng-container>
        </div>

         <!-- fall of wickets -->
        <div class="fall-of-wickets" *ngIf="selectedMatch.matchType !== 'Test'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

      </div>

                                <!--Test Match Inngings  -->
      <div class="scorecard-teams-visible" *ngIf="selectedMatch.type !== 'upcoming' && selectedMatch.matchType === 'Test'">

        <!-- Team A Batting & Team B Bowling first inngings-->
        <div class="team-scorecard" *ngIf="activeinnings === 'one'" >
          <span class="TeamsScoreFont">{{ selectedMatch.teamA.name }} Batting 1st inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: teamAbatting }"></ng-container>

          <span class="TeamsScoreFont">{{ selectedMatch.teamB.name }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamBbowling }"></ng-container>
        </div>

        <div class="fall-of-wickets" *ngIf=" activeinnings === 'one'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

        
         <!-- Team B Batting & Team A Bowling first Inngings -->
        <div class="team-scorecard" *ngIf="activeinnings === 'one'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB.name }} Batting 1st inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: teamBbatting }"></ng-container>

          <span class="TeamsScoreFont">{{ selectedMatch.teamA.name }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamAbowling }"></ng-container>
        </div>

         <div class="fall-of-wickets" *ngIf=" activeinnings === 'one'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

        <!-- Team A Batting & Team B Bowling second inngings-->
        <div class="team-scorecard" *ngIf="activeinnings === 'two'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA.name }} Batting 2nd inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: teamAbatting }"></ng-container>

          <span class="TeamsScoreFont">{{ selectedMatch.teamB.name }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamBbowling }"></ng-container>
        </div>

         <div class="fall-of-wickets" *ngIf=" activeinnings === 'two'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>


                <!-- Team B Batting & Team A Bowling second Inngings -->
        <div class="team-scorecard" *ngIf="activeinnings === 'two'">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB.name }} Batting 2nd inns</span>
          <ng-container *ngTemplateOutlet="battingTable; context:{ batters: teamBbatting }"></ng-container>

          <span class="TeamsScoreFont">{{ selectedMatch.teamA.name }} Bowling</span>
          <ng-container *ngTemplateOutlet="bowlingTable; context:{ bowlers: teamAbowling }"></ng-container>
        </div>

        <div class="fall-of-wickets" *ngIf=" activeinnings === 'two'">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

      </div>

      <!-- Fall of wickets -->
        <ng-template #fallOfWicketTable let-wickets="wickets">
          <div class="table-scroll">
          <table *ngFor="let w of wickets">
            <tbody>
              <tr>
                <td>{{ w.player }}</td>
                <td>{{ w.score }}</td>
                <td>{{ w.over }}</td>
              </tr>
            </tbody>
          </table>
        </div>
          
        </ng-template>


        <!-- <div class="scorecard-teams-visible">
          <div class="fall-of-wickets">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>

        <div class="fall-of-wickets">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div>
        </div> -->

         <!-- <div class="fall-of-wickets">
             <span class="fallOfwicketsTitle">Fall Of Wickets</span>
             <ng-container *ngTemplateOutlet="fallOfWicketTable; context:{ wickets: fallOfWickets }"></ng-container>
        </div> -->

    </div>

    <!-- Squad Tab -->
    <div *ngIf="activeTab==='squad'">
      <!-- Show Both Teams' Squads by default -->
      <div class="squad-teams-visible">

        <!-- Team A Squad -->
        <div class="team-squad">
          <span class="TeamsScoreFont">{{ selectedMatch.teamA.name }} Squad</span>
          <ng-container *ngTemplateOutlet="squadTable; context:{ players: teamAsquad }"></ng-container>
        </div>

        <!-- Team B Squad -->
        <div class="team-squad">
          <span class="TeamsScoreFont">{{ selectedMatch.teamB.name }} Squad</span>
          <ng-container *ngTemplateOutlet="squadTable; context:{ players: teamBsquad }"></ng-container>
        </div>

      </div>
    </div>

    <!-- Reusable Squad Table Template -->
    <ng-template #squadTable let-players="players">
      <div class="table-scroll">
        <table class="scorecard-table">
          <thead>
            <tr>
              <th>Player</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let player of players">
              <td>{{ player }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-template>

    <!-- Videos Tab -->
    <div *ngIf="activeTab==='videos'">
      <p>Videos Not Available Right now.....</p>
    </div>
  </div>

    <!-- Match Details (ONLY SHOW ON SCORECARD) -->
  <div class="match-details" *ngIf="matchDetails">
    <p><strong>Tournament:</strong> {{matchDetails.tournament}}</p>
    <p><strong>Toss:</strong> {{matchDetails.toss}}</p>
    <p><strong>Venue:</strong> {{matchDetails.venue}}</p>
    <p><strong>On-Field Umpires:</strong> {{matchDetails.onFieldUmpires.join(', ')}}</p>
    <p><strong>Third Umpire:</strong> {{matchDetails.thirdUmpire}}</p>
    <p><strong>Referee:</strong> {{matchDetails.referee}}</p>
    <p><strong>Player Of The Match:</strong> {{matchDetails.playerOfTheMatch}}</p>
    <p><strong>Player Of The Series:</strong> {{matchDetails.playerOfTheSeries}}</p>
  </div>


</div>

<!-- --Reusable Team Block ---->
<ng-template #teamBlock let-team="team" let-side="side">
  <div class="team" [ngClass]="side+'-team'">
    <span class="team-name">{{ team.name }}</span>
    <img [src]="team.logo" />
    <div class="team-score">
      <ng-container *ngIf="selectedMatch.matchType==='Test'; else normalScore">
        <div class="innings-row">
          <div class="innings-header">
            <span *ngFor="let inn of team.innings; let i=index" class="innings-col">Inn {{ i+1 }}</span>
          </div>
          <div class="innings-score">
            <span *ngFor="let inn of team.innings" class="score-text innings-col">{{ inn.split('(')[0].trim() }}</span>
          </div>
          <div class="innings-overs">
            <span *ngFor="let inn of team.innings" class="overs-text innings-col">
              ({{ inn.split('(')[1] ? inn.split('(')[1].replace(')','') : '' }})
            </span>
          </div>
        </div>
      </ng-container>
      <ng-template #normalScore>
        <ng-container *ngIf="team.score; else yetToBat">
          <span class="score-text">{{ team.score.split(' ')[0] }}</span><br>
          <small class="overs-text">{{ team.score.split(' ')[1] || '' }}</small>
        </ng-container>
        <ng-template #yetToBat>{{ team.score || 'Yet to Bat' }}</ng-template>
      </ng-template>
    </div>
  </div>
</ng-template>

<!-- --Reusable Batting Table ---->
<ng-template #battingTable let-batters="batters">
  <div class="table-scroll">
    <table class="scorecard-table">
      <thead>
        <tr>
          <th>Batter</th>
          <th>R</th>
          <th>B</th>
          <th>4s</th>
          <th>6s</th>
          <th>SR</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let batter of batters">
          <td>{{ batter.player }}</td>
          <td>{{ batter.runs }}</td>
          <td>{{ batter.balls }}</td>
          <td>{{ batter.fours }}</td>
          <td>{{ batter.sixes }}</td>
          <td>{{ batter.sR }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-template>

<!-- --Reusable Bowling Table ---->
<ng-template #bowlingTable let-bowlers="bowlers">
  <div class="table-scroll">
    <table class="scorecard-table">
      <thead>
        <tr>
          <th>Bowler</th>
          <th>O</th>
          <th>M</th>
          <th>R</th>
          <th>W</th>
          <th>ER</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let bowler of bowlers">
          <td>{{ bowler.player }}</td>
          <td>{{ bowler.overs }}</td>
          <td>{{ bowler.maidens }}</td>
          <td>{{ bowler.runs }}</td>
          <td>{{ bowler.wickets }}</td>
          <td>{{ bowler.econ }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-template>
